<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
  <title>Config</title>
  <style type="text/css">
    /* <![CDATA[ */
    body { font-family: system-ui, Arial, sans-serif; margin: 2rem; }
    .top-actions { margin: 0 0 1rem 0; }
    .btn { display: inline-block; padding: .5rem .9rem; border: 1px solid #888; border-radius: .4rem; text-decoration: none; font-weight: 600; background: #f7f7f7; }
    .btn + .btn { margin-left: .75rem; }  /* space between buttons */
    .btn:focus, .btn:hover { background: #eee; }
    table { border-collapse: collapse; table-layout: fixed; width: 100%; }
    th, td { border: 1px solid #ccc; padding: .5rem; text-align: left; vertical-align: top; word-wrap: break-word; }
    caption { font-weight: bold; text-align: left; margin-bottom: .5rem; }
    ul { margin: 0; padding-left: 1.25rem; }
    /* ]]> */
  </style>
</head>
<body>
  <p class="top-actions">
    <a class="btn" href="/openapi/swagger"
      onclick="window.open(this.href); return false;"
      rel="noopener noreferrer">Open Swagger</a>
    <a class="btn" href="https://www.telia.ee/images/documents/juhendid/eng/MultiSMS_manual_eng.pdf"
      onclick="window.open(this.href); return false;"
      rel="noopener noreferrer">Telia MultiSMS manual (pdf)</a>
  </p>

  <h1>Current configuration</h1>

  {% set env_vars = config.get('env_vars', {}) %}

  <h2>App Configuration</h2>
  <table>
    <colgroup>
      <col style="width:30%" />
      <col style="width:70%" />
    </colgroup>
    <thead>
      <tr>
        <th>Envvar</th>
        <th>Value</th>
      </tr>
    </thead>
    <tbody>
      {% for key, value in env_vars.items() %}
        <tr>
          <td>{{ key }}</td>
          <td>{{ value }}</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>

  {% set groups = config.get('receiver_groups', []) %}

  <h2>Receiver Groups</h2>
  <table>
    <colgroup>
      <col style="width:15%" />
      <col style="width:25%" />
      <col style="width:50%" />
    </colgroup>
    <thead>
      <tr>
        <th>Name</th>
        <th>Description</th>
        <th>Receivers</th>
      </tr>
    </thead>
    <tbody>
      {% if not groups %}
        <tr>
          <td colspan="3"><em>No receiver groups configured</em></td>
        </tr>
      {% else %}
      {% for g in groups %}
        <tr>
          <td>{{ g.name }}</td>
          <td>{{ g.description }}</td>
          <td>
            {% if g.receivers %}
              <ul>
                {% for r in g.receivers %}
                  <li>{{ r.number }} - {{ r.name }}</li>
                {% endfor %}
              </ul>
            {% else %}
              <em>No receivers</em>
            {% endif %}
          </td>
        </tr>
      {% endfor %}
      {% endif %}
    </tbody>
  </table>
</body>
</html>